<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Brainrot-Fighter-Leaderboard</title>
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Helvetica Neue", Arial, sans-serif;
        color: #f5f5f7;
        background:
          radial-gradient(circle at 0% 0%, #1b2440 0, transparent 50%),
          radial-gradient(circle at 100% 0%, #532b7f 0, transparent 55%),
          radial-gradient(circle at 0% 100%, #165c5f 0, transparent 55%),
          radial-gradient(circle at 100% 100%, #8f3f6a 0, transparent 55%),
          #020617;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image: url("https://grainy-gradients.vercel.app/noise.svg");
        opacity: 0.18;
        mix-blend-mode: soft-light;
      }

      .phone-frame {
        position: relative;
        width: min(430px, 100% - 32px);
        height: 860px;
        border-radius: 36px;
        padding: 18px;
        background: radial-gradient(circle at 10% 0, #ffffff1f, transparent 60%),
          radial-gradient(circle at 90% 100%, #ffffff1f, transparent 55%),
          #020617;
        box-shadow:
          0 0 0 1px rgba(255, 255, 255, 0.04),
          0 18px 60px rgba(0, 0, 0, 0.85);
        overflow: hidden;
      }

      .phone-inner {
        position: relative;
        height: 100%;
        border-radius: 28px;
        padding: 18px 16px 20px;
        background: linear-gradient(
          155deg,
          rgba(15, 23, 42, 0.96),
          rgba(15, 23, 42, 0.85)
        );
        box-shadow:
          0 0 0 1px rgba(148, 163, 184, 0.18),
          0 24px 80px rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(32px);
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .top-meta {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .app-label {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 2px 10px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: linear-gradient(
          135deg,
          rgba(15, 23, 42, 0.9),
          rgba(51, 65, 85, 0.9)
        );
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.8);
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #e5e7eb;
      }

      .dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: radial-gradient(circle, #4ade80, #22c55e);
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.22);
      }

      .title {
        font-size: 22px;
        font-weight: 700;
        letter-spacing: 0.02em;
      }

      .subtitle {
        font-size: 13px;
        color: #9ca3af;
      }

      .pill-nav {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.5);
        box-shadow:
          0 0 0 1px rgba(15, 23, 42, 0.95),
          0 18px 45px rgba(0, 0, 0, 0.7);
      }

      .pill-button {
        flex: 1;
        border-radius: 999px;
        padding: 8px 0;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        border: none;
        background: transparent;
        color: #9ca3af;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        cursor: pointer;
        transition: all 0.16s ease-out;
      }

      .pill-button span.icon {
        width: 16px;
        height: 16px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
      }

      .pill-button.is-active {
        background: radial-gradient(circle at 0 0, #22c55e33, transparent 55%),
          radial-gradient(circle at 100% 100%, #22d3ee2c, transparent 55%),
          linear-gradient(135deg, #f97316, #facc15);
        color: #111827;
        box-shadow:
          0 12px 30px rgba(248, 250, 252, 0.18),
          0 0 0 1px rgba(15, 23, 42, 0.8);
        transform: translateY(-1px);
      }

      .pill-button.is-active span.icon {
        border-color: rgba(15, 23, 42, 0.6);
        background: rgba(15, 23, 42, 0.1);
      }

      .glass-panel {
        position: relative;
        flex: 1;
        border-radius: 26px;
        padding: 14px 10px 12px;
        background: radial-gradient(circle at 0 0, #ffffff15, transparent 55%),
          radial-gradient(circle at 100% 100%, #0ea5e914, transparent 60%),
          linear-gradient(
            160deg,
            rgba(15, 23, 42, 0.98),
            rgba(15, 23, 42, 0.92)
          );
        border: 1px solid rgba(148, 163, 184, 0.45);
        box-shadow:
          0 18px 50px rgba(15, 23, 42, 0.9),
          0 0 0 1px rgba(15, 23, 42, 1);
        backdrop-filter: blur(30px);
        display: flex;
        flex-direction: column;
        gap: 14px;
        overflow: hidden;
      }

      /* --- View Switching --- */
      .view-section {
        display: none;
        flex: 1;
        flex-direction: column;
        gap: 14px;
        animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .view-section.active {
        display: flex;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* --- Friends / Shared Styles --- */
      .podium-header {
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding: 0 4px;
      }

      .podium-title {
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #e5e7eb;
      }

      .podium-title span:last-child {
        font-size: 11px;
        color: #9ca3af;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .podium {
        display: flex;
        align-items: flex-end;
        justify-content: center;
        gap: 14px;
        padding: 14px 4px 10px;
      }

      .podium-item {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        min-width: 0;
      }

      .podium-pill {
        width: 100%;
        border-radius: 20px;
        padding: 16px 14px 14px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: radial-gradient(circle at 0 0, #22c55e2b, transparent 60%),
          radial-gradient(circle at 100% 0, #f9731633, transparent 65%),
          linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
        text-align: center;
      }

      .podium-pill.primary {
        background: radial-gradient(circle at 15% 0, #22c55e4a, transparent 60%),
          radial-gradient(circle at 100% 0, #facc1544, transparent 65%),
          linear-gradient(145deg, #18181b, #0f172a);
        border-color: rgba(250, 250, 250, 0.56);
        box-shadow:
          0 16px 40px rgba(15, 23, 42, 0.96),
          0 0 0 1px rgba(15, 23, 42, 0.8);
        transform: translateY(-4px);
      }

      .podium-avatar-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: -20px;
        z-index: 2;
      }
      
      .podium-rank-number {
        font-size: 20px;
        font-weight: 900;
        color: #e5e7eb;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        margin-bottom: 4px;
        font-style: italic;
      }

      .podium-item:nth-child(2) .podium-rank-number {
        font-size: 28px;
        color: #facc15;
      }

      .podium-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid rgba(148, 163, 184, 0.5);
        background: #1e293b;
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      }

      .podium-item:nth-child(2) .podium-avatar {
        width: 72px;
        height: 72px;
        border-color: #facc15;
        box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.2), 0 12px 30px rgba(0,0,0,0.5);
      }

      .podium-name {
        font-size: 13px;
        font-weight: 600;
        color: #e5e7eb;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        max-width: 100%;
      }

      .podium-bar {
        width: 100%;
        border-radius: 999px;
        overflow: hidden;
        height: 6px;
        background: rgba(31, 41, 55, 0.9);
      }

      .podium-bar-fill {
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, #22c55e, #facc15);
      }

      .list {
        margin-top: 2px;
        padding: 8px 2px 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow: auto;
      }

      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        border-radius: 999px;
        padding: 8px 14px;
        background: radial-gradient(circle at 0 0, #22c55e12, transparent 65%),
          linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
        border: 1px solid rgba(31, 41, 55, 0.95);
        box-shadow: 0 10px 26px rgba(15, 23, 42, 0.9);
      }

      .row:nth-child(even) {
        background: radial-gradient(circle at 100% 0, #0ea5e912, transparent 65%),
          linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.9));
      }

      .row-left {
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 0;
      }

      .row-rank {
        width: 26px;
        height: 26px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        font-weight: 700;
        background: radial-gradient(circle at 30% 0, #22c55e66, transparent 65%),
          rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.9);
        color: #e5e7eb;
      }

      .row-rank.highlight {
        background: radial-gradient(circle at 20% 0, #facc1560, transparent 70%),
          #0f172a;
        border-color: rgba(250, 250, 250, 0.9);
        color: #fef9c3;
      }

      .row-user {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
      }

      .row-name {
        font-size: 14px;
        font-weight: 600;
        color: #e5e7eb;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        max-width: 170px;
      }

      .row-meta {
        font-size: 11px;
        color: #9ca3af;
      }

      .row-right {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
      }

      .row-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        object-fit: cover;
        border: 1px solid rgba(255,255,255,0.1);
        background: #1e293b;
      }

      .trend {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid;
      }

      .trend.up {
        border-color: rgba(22, 163, 74, 0.8);
        color: #bbf7d0;
        background: rgba(22, 163, 74, 0.15);
      }

      .trend.down {
        border-color: rgba(239, 68, 68, 0.85);
        color: #fecaca;
        background: rgba(239, 68, 68, 0.16);
      }

      .trend-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
      }

      .trend.up .trend-dot {
        background: linear-gradient(135deg, #22c55e, #4ade80);
      }

      .trend.down .trend-dot {
        background: linear-gradient(135deg, #f97316, #ef4444);
      }

      /* --- Personal View Styles --- */
      .st-header {
        text-align: center;
        margin-top: 8px;
        margin-bottom: 16px;
      }
      .st-title {
        font-size: 13px;
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 2px;
      }
      .st-time {
        font-size: 42px;
        font-weight: 800;
        color: #e5e7eb;
        letter-spacing: -0.02em;
        line-height: 1.1;
      }
      .st-trend {
        font-size: 13px;
        color: #9ca3af;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        margin-top: 4px;
      }
      .st-chart {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        height: 180px;
        padding: 20px 8px 0;
        margin-bottom: 20px;
        position: relative;
      }
      .st-chart::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        border-top: 1px dashed rgba(255,255,255,0.1);
        z-index: 0;
      }
      .st-bar-col {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        flex: 1;
        z-index: 1;
      }
      .st-bar-bg {
        width: 8px;
        height: 120px;
        background: rgba(255,255,255,0.06);
        border-radius: 999px;
        position: relative;
        overflow: hidden;
      }
      .st-bar-fill {
        position: absolute;
        bottom: 0;
        width: 100%;
        background: #3b82f6;
        border-radius: 999px;
        min-height: 6px;
        transition: height 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      .st-bar-label {
        font-size: 11px;
        color: #6b7280;
        font-weight: 600;
      }
      /* Highlight "Today" or active bar */
      .st-bar-col.active .st-bar-fill {
        background: #facc15;
        box-shadow: 0 0 16px rgba(250, 204, 21, 0.4);
      }
      .st-bar-col.active .st-bar-label {
        color: #e5e7eb;
      }

      /* Fake app list */
      .app-row {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
      }
      .app-row:last-child { border-bottom: none; }
      .app-icon {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        background: #333;
      }
      .app-info { flex: 1; display: flex; flex-direction: column; gap: 2px; }
      .app-name { font-size: 13px; font-weight: 600; color: #e5e7eb; }
      .app-cat { font-size: 11px; color: #9ca3af; }
      .app-time { font-size: 13px; font-weight: 600; color: #e5e7eb; }

      /* --- Partner View Styles --- */
      .partner-selector-container {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 0 4px;
      }
      .partner-select-label {
        font-size: 13px;
        color: #9ca3af;
        font-weight: 600;
      }
      .partner-select {
        flex: 1;
        padding: 8px 12px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(15, 23, 42, 0.8);
        color: #e5e7eb;
        font-size: 13px;
        outline: none;
        appearance: none; /* Remove default arrow on some browsers */
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%239ca3af%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        background-size: 10px;
      }

      .partner-container {
        display: flex;
        gap: 12px;
        height: 100%;
        align-items: center;
        justify-content: center;
        margin-top: 20px;
        position: relative;
      }
      .partner-card {
        flex: 1;
        background: linear-gradient(145deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8));
        border-radius: 24px;
        padding: 30px 12px;
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 1px solid rgba(148, 163, 184, 0.2);
        position: relative;
        transition: transform 0.3s;
        min-height: 260px;
      }
      .partner-card.winner {
        border-color: rgba(250, 204, 21, 0.6);
        background: radial-gradient(circle at 50% 0, rgba(250, 204, 21, 0.15), rgba(30, 41, 59, 0.7));
        transform: scale(1.05) translateY(-6px);
        z-index: 1;
        box-shadow: 0 20px 50px rgba(0,0,0,0.4), 0 0 0 1px rgba(250, 204, 21, 0.3);
      }
      .partner-avatar {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        border: 3px solid rgba(255,255,255,0.15);
        margin-bottom: 16px;
        object-fit: cover;
        background: #0f172a;
      }
      .partner-card.winner .partner-avatar {
        border-color: #facc15;
        box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.25);
      }
      .partner-name {
        font-size: 15px;
        font-weight: 700;
        color: #e5e7eb;
        margin-bottom: 6px;
        text-align: center;
      }
      .partner-time {
        font-size: 28px;
        font-weight: 800;
        color: #e5e7eb;
        margin-bottom: 12px;
      }
      .partner-status {
        padding: 6px 14px;
        border-radius: 999px;
        font-size: 11px;
        font-weight: 700;
        background: rgba(255,255,255,0.1);
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .partner-card.winner .partner-status {
        background: linear-gradient(135deg, #facc15, #f97316);
        color: #0f172a;
        box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
      }
      .vs-badge {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #0f172a;
        border: 2px solid rgba(255,255,255,0.1);
        color: #facc15;
        font-size: 12px;
        font-weight: 900;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
      }

      .footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 11px;
        color: #6b7280;
        padding: 0 6px;
      }

      .footer span:last-child {
        color: #9ca3af;
      }

      .footer strong {
        color: #e5e7eb;
      }

      @media (max-height: 820px) {
        .phone-frame {
          height: 760px;
        }
      }

      @media (max-height: 720px) {
        .phone-frame {
          height: 680px;
        }
      }

      @media (max-width: 600px) {
        body {
          align-items: stretch;
          justify-content: flex-start;
        }

        .phone-frame {
          width: 100%;
          height: auto;
          min-height: 100vh;
          border-radius: 0;
          padding: 0;
          background: none;
          box-shadow: none;
        }

        .phone-inner {
          border-radius: 0;
          padding: 16px 12px 20px;
          box-shadow: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="phone-frame">
      <div class="phone-inner">
        <header class="top-bar">
          <div class="top-meta">
            <div class="app-label">
              <span class="dot"></span>
              Focus ¬∑ Leaderboard
            </div>
            <div class="title">Brainrot-Fighter</div>
            <div class="subtitle">Recover your time, one minute at a time.</div>
          </div>
        </header>

        <nav class="pill-nav" aria-label="Leaderboard mode">
          <button class="pill-button" type="button" data-tab="personal">
            <span class="icon">üë§</span>
            Personal
          </button>
          <button class="pill-button" type="button" data-tab="partner">
            <span class="icon">üë•</span>
            Partner
          </button>
          <button class="pill-button is-active" type="button" data-tab="friends">
            <span class="icon">ü§ù</span>
            Friends
          </button>
        </nav>

        <section class="glass-panel" aria-label="Content Area">
          
          <!-- PERSONAL VIEW -->
          <div id="view-personal" class="view-section">
            <div class="st-header">
              <div class="st-title">Daily Average</div>
              <div class="st-time" id="personal-total-time">--</div>
              <div class="st-trend" id="personal-trend">...</div>
            </div>
            <div class="st-chart" id="personal-chart">
              <!-- Chart Bars injected by JS -->
            </div>
            <div class="list" style="margin-top: 0; flex: 1; overflow: auto;">
               <div class="podium-title" style="margin-bottom: 8px">Most Used Apps</div>
               <!-- Fake Apps -->
               <div class="app-row">
                 <div class="app-icon" style="background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white;">üì∏</div>
                 <div class="app-info">
                   <div class="app-name">Instagram</div>
                   <div class="app-cat">Social</div>
                 </div>
                 <div class="app-time">2h 14m</div>
               </div>
               <div class="app-row">
                 <div class="app-icon" style="background: black; color: white;">üéµ</div>
                 <div class="app-info">
                   <div class="app-name">TikTok</div>
                   <div class="app-cat">Entertainment</div>
                 </div>
                 <div class="app-time">1h 45m</div>
               </div>
               <div class="app-row">
                 <div class="app-icon" style="background: #ff0000; color: white;">‚ñ∂Ô∏è</div>
                 <div class="app-info">
                   <div class="app-name">YouTube</div>
                   <div class="app-cat">Entertainment</div>
                 </div>
                 <div class="app-time">55m</div>
               </div>
            </div>
          </div>

          <!-- PARTNER VIEW -->
          <div id="view-partner" class="view-section">
          <header class="podium-header">
            <div class="podium-title">
                 <span>1v1 Battle</span>
                 <span>Today</span>
               </div>
            </header>
            
            <!-- Opponent Selector -->
            <div class="partner-selector-container">
              <label for="partner-select" class="partner-select-label">Choose Opponent:</label>
              <select id="partner-select" class="partner-select">
                <!-- Options injected by JS -->
              </select>
            </div>

            <div class="partner-container" id="partner-content">
               <!-- Injected by JS -->
            </div>
             <div style="text-align: center; margin-top: auto; font-size: 11px; color: #6b7280;">
              Lower screen time wins the battle!
            </div>
          </div>

          <!-- FRIENDS VIEW (Original) -->
          <div id="view-friends" class="view-section active">
            <header class="podium-header">
              <div class="podium-title">
                <span>Top 3 ¬∑ Screen time recovered 28 Dec</span>
              <span>Updated every night at 00:00</span>
            </div>
          </header>

          <div class="podium" id="podium"></div>
          <div class="list" id="leaderboard-list" aria-label="Full ranking list"></div>
          </div>

        </section>

        <footer class="footer">
          <span>Sample data ¬∑ UI only</span>
          <span>Unit: <strong>percentage vs yesterday</strong></span>
        </footer>
      </div>
    </div>
    <script>
      (function () {
        // --- DATA LOADING & PARSING ---
        const fallbackDay0 = [
          { name: "Brooklyn Simmons", durationMinutes: 50 },
          { name: "Bradley Henry", durationMinutes: 40 },
          { name: "Guy Hawkins", durationMinutes: 55 },
          { name: "Albert Flores", durationMinutes: 75 },
          { name: "Sarai Shihara", durationMinutes: 65 },
          { name: "Zihan Luo", durationMinutes: 90 },
          { name: "Jacob Thompson", durationMinutes: 80 },
          { name: "Natasha Roman", durationMinutes: 120 },
          { name: "Courtney Bell", durationMinutes: 100 },
          { name: "Jordan Lee", durationMinutes: 110 }
        ];

        const fallbackDay1 = [
          { name: "Brooklyn Simmons", durationMinutes: 47 },
          { name: "Bradley Henry", durationMinutes: 57 },
          { name: "Guy Hawkins", durationMinutes: 61 },
          { name: "Albert Flores", durationMinutes: 70 },
          { name: "Sarai Shihara", durationMinutes: 78 },
          { name: "Zihan Luo", durationMinutes: 85 },
          { name: "Jacob Thompson", durationMinutes: 92 },
          { name: "Natasha Roman", durationMinutes: 99 },
          { name: "Courtney Bell", durationMinutes: 106 },
          { name: "Jordan Lee", durationMinutes: 113 }
        ];

        let globalEntries = []; // Store processed data for reuse

        function parseDayCsv(text) {
          const lines = text.trim().split(/\r?\n/);
          if (lines.length <= 1) return [];
          const headers = lines[0].split(",").map((h) => h.trim());
          const nameIndex = headers.findIndex((h) => h.toLowerCase() === "name");
          const minutesIndex = headers.findIndex((h) => {
            const lower = h.toLowerCase();
            return (lower === "minutes" || lower === "minute" || lower === "durationminutes");
          });
          if (nameIndex === -1 || minutesIndex === -1) return [];
          const rows = [];
          for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            const cols = line.split(",").map((c) => c.trim());
            const name = cols[nameIndex];
            const minutesRaw = cols[minutesIndex];
            if (!name) continue;
            const minutes = Number(minutesRaw);
            if (!Number.isNaN(minutes)) {
              rows.push({ name, durationMinutes: minutes });
            }
          }
          return rows;
        }

        function formatDuration(minutes) {
          const h = Math.floor(minutes / 60);
          const m = minutes % 60;
          return (h > 0 ? h + "h " : "") + m + "m";
        }

        // --- AVATAR HELPERS ---
          const avatarMap = {
          "Andita": "Andita.png", "Andrash": "Andrash.png", "Anyssa": "Anyssa.jpg",
          "Ayu": "Ayu.jpg", "Febby": "Febby.jpg", "Ghifary": "Ghifary.jpg",
          "Glory": "Glory.png", "Hannah": "Hannah.jpg", "Maya": "Maya.jpg",
          "Naomi": "Naomi.jpg", "Nicho": "Nicho.jpg", "Pradhira": "Pradhira.png",
          "Shastya": "Shastya.jpg", "William": "William.png"
          };

          function getAvatar(name) {
            if (avatarMap[name]) return "img/" + avatarMap[name];
            const first = name.split(' ')[0];
            if (avatarMap[first]) return "img/" + avatarMap[first];
            return "https://ui-avatars.com/api/?name=" + encodeURIComponent(name) + "&background=random";
          }

        // --- RENDER FUNCTIONS ---

        // 1. FRIENDS (Leaderboard)
        function buildLeaderboard(day0, day1) {
          const prevMinutesMap = new Map();
          const previous = Array.isArray(day0) && day0.length ? day0 : day1;
          previous.forEach((item) => prevMinutesMap.set(item.name, item.durationMinutes));

          const entries = day1.map((today) => {
            const prevMinutes = prevMinutesMap.has(today.name) ? prevMinutesMap.get(today.name) : today.durationMinutes;
            const changeMinutes = today.durationMinutes - prevMinutes;
            const percentChange = prevMinutes > 0 ? (changeMinutes / prevMinutes) * 100 : 0;
            return { ...today, prevMinutes, changeMinutes, percentChange };
          });

          // Sort by improvement (most negative change first)
          const sorted = [...entries].sort((a, b) => a.percentChange - b.percentChange);
          globalEntries = sorted; // Save for other views

          const podiumEl = document.getElementById("podium");
          const listEl = document.getElementById("leaderboard-list");
          if (!podiumEl || !listEl) return;

          podiumEl.innerHTML = "";
          listEl.innerHTML = "";

          const top3 = sorted.slice(0, 3);
          const rest = sorted.slice(3);

          // Podium Scaling
          const durationsTop = top3.map((d) => d.durationMinutes);
          const maxD = Math.max(...durationsTop);
          const minD = Math.min(...durationsTop);
          function barWidth(minutes) {
            if (maxD === minD) return "100%";
            const score = (maxD - minutes) / (maxD - minD);
             return Math.round((0.3 + score * 0.7) * 100) + "%";
          }

          const podiumOrder = [1, 0, 2];
          podiumOrder.forEach((idx) => {
            const entry = top3[idx];
            if (!entry) return;
            const rank = sorted.indexOf(entry) + 1;

            const item = document.createElement("div");
            item.className = "podium-item";
            item.innerHTML = `
              <div class="podium-avatar-container">
                <div class="podium-rank-number">${rank}</div>
                <img class="podium-avatar" src="${getAvatar(entry.name)}" alt="${entry.name}">
              </div>
              <div class="podium-pill ${rank === 1 ? 'primary' : ''}">
                <div class="podium-name">${entry.name}</div>
                <div class="trend ${entry.percentChange < 0 ? 'up' : 'down'}">
                  <span class="trend-dot"></span>
                  ${entry.percentChange > 0 ? '+' : ''}${Math.round(entry.percentChange * 10)/10}%
                </div>
                <div class="podium-bar">
                  <div class="podium-bar-fill" style="width: ${barWidth(entry.durationMinutes)}"></div>
                </div>
              </div>
            `;
            podiumEl.appendChild(item);
          });

          rest.forEach((entry) => {
            const rank = sorted.indexOf(entry) + 1;
            const row = document.createElement("div");
            row.className = "row";
            const isDecrease = entry.percentChange < 0;
            row.innerHTML = `
              <div class="row-left">
                <div class="row-rank ${rank === 4 ? 'highlight' : ''}">${rank}</div>
                <img class="row-avatar" src="${getAvatar(entry.name)}" alt="${entry.name}">
                <div class="row-user">
                  <div class="row-name">${entry.name}</div>
                  <div class="row-meta">Today's screen time</div>
                </div>
              </div>
              <div class="row-right">
                <div class="trend ${isDecrease ? 'up' : 'down'}">
                  <span class="trend-dot"></span>
                  ${entry.percentChange > 0 ? '+' : ''}${Math.round(entry.percentChange * 10)/10}%
                </div>
              </div>
            `;
            listEl.appendChild(row);
          });

          // Initialize other views after data is ready
          renderPersonal();
          renderPartner();
        }

        // 2. PERSONAL (Screen Time)
        function renderPersonal() {
          const totalTimeEl = document.getElementById('personal-total-time');
          const trendEl = document.getElementById('personal-trend');
          const chartEl = document.getElementById('personal-chart');
          
          // Mock Data for "You"
          const weekDays = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
          // Generate some random realistic data
          const dailyData = [320, 280, 350, 410, 290, 180, 0]; // mins, last one is today
          
          // Use one user from our CSV as "You" for today's value
          const me = globalEntries.find(e => e.name === "You") || globalEntries[0]; 
          if (me) {
             dailyData[6] = me.durationMinutes;
          } else {
             dailyData[6] = 245; // Fallback if no data
          }

          const todayMins = dailyData[6];
          totalTimeEl.textContent = formatDuration(todayMins);
          
          // Trend (compare to yesterday)
          const yesterday = dailyData[5];
          const diff = todayMins - yesterday;
          const pct = Math.round((diff / yesterday) * 100);
          const isUp = diff > 0;
          trendEl.innerHTML = `
            <span style="color: ${isUp ? '#ef4444' : '#4ade80'}">
              ${isUp ? '‚ñ≤' : '‚ñº'} ${Math.abs(pct)}%
            </span> from yesterday
          `;

          // Chart
          chartEl.innerHTML = '';
          const maxVal = Math.max(...dailyData, 400); // Scale
          
          dailyData.forEach((mins, idx) => {
            const heightPct = (mins / maxVal) * 100;
            const isToday = idx === 6;
            
            const col = document.createElement('div');
            col.className = `st-bar-col ${isToday ? 'active' : ''}`;
            col.innerHTML = `
              <div class="st-bar-bg">
                <div class="st-bar-fill" style="height: ${heightPct}%"></div>
              </div>
              <div class="st-bar-label">${weekDays[idx]}</div>
            `;
            chartEl.appendChild(col);
          });
        }

        // 3. PARTNER (1v1)
        function renderPartner() {
          const container = document.getElementById('partner-content');
          const selectEl = document.getElementById('partner-select');
          if (!globalEntries.length) return;

          // 1. Pick "Me" (assume first entry is current user for demo)
          const me = globalEntries[0];

          // 2. Define "Consented" Opponents (subset of globalEntries)
          // In a real app, this would come from a "friends who consented" API
          // For demo, let's pick 3 specific names + "Random"
          const consentedNames = ["Maya", "Liam", "Sophia", "Nicho", "Glory"]; 
          // Filter globalEntries to find these people (if they exist in CSV)
          // Also add a "Random" option
          
          // Populate select only once (or if empty)
          if (selectEl.options.length === 0) {
            // Add "Random" option first
            const randomOpt = document.createElement('option');
            randomOpt.value = 'random';
            randomOpt.textContent = 'üé≤ Random Opponent';
            selectEl.appendChild(randomOpt);

            consentedNames.forEach(name => {
              // Check if this person exists in our data
              const person = globalEntries.find(e => e.name.includes(name));
              if (person && person.name !== me.name) {
                const opt = document.createElement('option');
                opt.value = person.name;
                opt.textContent = person.name;
                selectEl.appendChild(opt);
              }
            });
            
            // Add change listener
            selectEl.addEventListener('change', () => renderPartner());
          }

          // 3. Determine Opponent based on Selection
          let opponent;
          const selectedValue = selectEl.value;

          if (selectedValue === 'random') {
             // Pick random from consented list or global list (excluding me)
             // Let's stick to global list for "random" to keep it fun
             let candidates = globalEntries.filter(e => e.name !== me.name);
             if (candidates.length > 0) {
                const randIdx = Math.floor(Math.random() * candidates.length);
                opponent = candidates[randIdx];
             }
          } else {
             // Find specific person
             opponent = globalEntries.find(e => e.name === selectedValue);
          }

          // Fallback if opponent not found
          if (!opponent) {
             opponent = globalEntries[1] || me; 
          }

          const myTime = me.durationMinutes;
          const oppTime = opponent.durationMinutes;
          const iWin = myTime < oppTime; 
          
          // Helper to create card HTML
          function createCard(entry, isWinner, isMe) {
             return `
               <div class="partner-card ${isWinner ? 'winner' : ''}">
                 <img class="partner-avatar" src="${getAvatar(entry.name)}" alt="${entry.name}">
                 <div class="partner-name">${isMe ? 'You (' + entry.name + ')' : entry.name}</div>
                 <div class="partner-time">${formatDuration(entry.durationMinutes)}</div>
                 <div class="partner-status">${isWinner ? 'Winning' : 'Trailing'}</div>
               </div>
             `;
          }

          container.innerHTML = `
            ${createCard(me, iWin, true)}
            <div class="vs-badge">VS</div>
            ${createCard(opponent, !iWin, false)}
          `;
        }

        // --- TAB SWITCHING ---
        const tabs = document.querySelectorAll('.pill-button');
        const views = document.querySelectorAll('.view-section');

        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            // Update Tabs
            tabs.forEach(t => t.classList.remove('is-active'));
            tab.classList.add('is-active');

            // Update View
            const target = tab.dataset.tab;
            views.forEach(view => {
              if (view.id === `view-${target}`) {
                view.classList.add('active');
              } else {
                view.classList.remove('active');
              }
            });
            
            // Re-render dynamic views if needed
            if (target === 'partner') renderPartner(); 
          });
        });

        // --- INIT ---
        async function loadLeaderboard() {
          let day0 = [], day1 = [];
          try {
            const res0 = await fetch("day0.csv", { cache: "no-store" });
            if (res0.ok) day0 = parseDayCsv(await res0.text());
            else day0 = fallbackDay0;
          } catch (e) { day0 = fallbackDay0; }

          try {
            const res1 = await fetch("day1.csv", { cache: "no-store" });
            if (res1.ok) day1 = parseDayCsv(await res1.text());
            else day1 = fallbackDay1;
          } catch (e) { day1 = fallbackDay1; }

          buildLeaderboard(day0, day1);
        }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", loadLeaderboard);
        } else {
          loadLeaderboard();
        }
      })();
    </script>
  </body>
</html>
